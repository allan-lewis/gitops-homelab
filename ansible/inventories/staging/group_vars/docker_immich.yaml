---
compose_app_name: immich
compose_immich_version: "v2.1.0"

# Use the vendor compose from the exact release tag
compose_source_type: url
compose_url: "https://github.com/immich-app/immich/releases/download/{{ compose_immich_version }}/docker-compose.yml"

# Everything here is auto-validated (undefined/empty => fail early)
compose_env:
  IMMICH_VERSION: "{{ compose_immich_version }}"
  # TODO: For PROD
  # UPLOAD_LOCATION: "/mnt/immich"
  UPLOAD_LOCATION: "/srv/immich/uploads"
  DB_DATA_LOCATION: "/srv/immich/postgres"
  REDIS_DATA_LOCATION: "/srv/immich/redis"
  MODEL_CACHE_LOCATION: "/srv/immich/model-cache"
  COMPOSE_PROJECT_NAME: "immich"
  DB_USERNAME: "postgres"
  DB_DATABASE_NAME: "immich"
  DB_PASSWORD: "{{ lookup('env', 'IMMICH_DB_PASSWORD') }}"

compose_paths:
  # TODO: For PROD
  # NFS uploads (do not chown from client; role will verify it's NFS-mounted)
  # - path: "/mnt/immich"
  #   create: false
  #   mode: "0755"
  #   nfs: true
  #   nfs_server: "{{ hostvars['procyon'].ansible_host }}"
  #   nfs_path: "/mnt/pool1/immich"
  #   nfs_opts: "rw,sync,hard,intr"
  - path: "/srv/immich/uploads"
    create: true
    mode: "0755"

  # Postgres data (local; container will chown on first init)
  - path: "/srv/immich/postgres"
    create: true
    mode: "0755"

  # Redis data (local; volatile)
  - path: "/srv/immich/redis"
    create: true
    mode: "0755"

  # Model cache (local; volatile) â€” leave root-owned
  - path: "/srv/immich/model-cache"
    create: true
    mode: "0755"
