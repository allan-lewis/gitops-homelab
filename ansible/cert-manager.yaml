---
- name: Generate k8s manifests for Cert Manager.
  hosts: localhost
  become: no
  gather_facts: no
  vars:
    gitops_file_url: "https://github.com/cert-manager/cert-manager/releases/download/v1.17.0/cert-manager.yaml"
    gitops_file_dest: "gitops-k8s-cert-manager-install.yaml"

  roles:
    - role: gitops-get-file
      vars:
        gitops_output_dir: "../model/cert-manager/nonprod/"
    - role: gitops-get-file
      vars:
        gitops_output_dir: "../model/cert-manager/production/"

  tasks:
    - name: Write the cluster issuer for Metal LB.
      ansible.builtin.template:
        src: "gitops-k8s-cert-manager-cluster-issuer.yaml.j2"
        dest: "{{ item }}"
      with_items:
        - "../model/cert-manager/nonprod/gitops-k8s-cert-manager-cluster-issuer.yaml"
        - "../model/cert-manager/production/gitops-k8s-cert-manager-cluster-issuer.yaml"
