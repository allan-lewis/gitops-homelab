---
- name: Ensure we are on Ubuntu
  ansible.builtin.assert:
    that: ansible_facts['distribution'] == 'Ubuntu'
    fail_msg: "This role targets Ubuntu only."

# ---- Phase 1: Install (Step 1) ----
- name: Phase 1 - Install core packages
  ansible.builtin.import_tasks: install.yaml

# ---- Phase 2: Baseline config (Step 2) ----
- name: Phase 2 - Baseline configuration
  ansible.builtin.import_tasks: config.yaml

# ---- Phase 3: Rootless setup (Step 3) ----
- name: Phase 3 - Rootless setup
  ansible.builtin.import_tasks: rootless.yaml
  when: podman_users | length > 0

# ---- Step 4: Extras (optional) ----
- name: Phase 4 - Extras (socket, docker shim, compose)
  ansible.builtin.import_tasks: extras.yaml
